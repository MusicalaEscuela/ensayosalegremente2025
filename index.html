<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cronograma de Ensayos ‚Äì AlegreMente 2025</title>

  <!-- Fuente moderna -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <link rel="icon" href="logo.jpg" type="image/jpeg">
  <link rel="stylesheet" href="style.css">

  <!-- Hotfixes + ajustes solicitados -->
  <style>
    /* 1) Ocultar puntos azules de la l√≠nea de tiempo */
    .timeline .marks{ display:none !important; }

    /* 2) Mensaje cuando no hay filas en la tabla (por ejemplo al elegir un d√≠a sin eventos) */
    .tablewrap:has(tbody:empty)::after{
      content: "No hay eventos hoy.";
      display: flex; align-items: center; justify-content: center;
      padding: 40px; color: var(--muted); font-size: 14px;
    }

    /* 3) Hacer m√°s peque√±o el texto del KPI del d√≠a y de la pr√≥xima fecha */
    .kpis .k:nth-child(2) .v{ font-size:18px; line-height:1.1; }
    .kpis .k:nth-child(3) .v{ font-size:18px; line-height:1.1; }
    /* Para evitar desbordes en t√≠tulos largos de d√≠a/fecha */
    .k .v{ word-break:break-word; overflow-wrap:anywhere; }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="head wrap">
      <img src="logo.jpg" alt="Logo Musicala" class="logo" onerror="this.style.display='none'">
      <div>
        <h1 class="h1">Cronograma de Ensayos ‚Äì AlegreMente 2025</h1>
        <div class="sub">Hoy es <span id="hoyHeader">‚Äî</span>. No hay ensayos previos registrados.</div>
      </div>
      <div class="spacer"></div>
      <button id="btnPrint" class="iconbtn" title="Imprimir">
        <span class="icon">üñ®Ô∏è</span> Imprimir
      </button>
    </div>
  </header>

  <main class="wrap">
    <!-- Columna izquierda: Fechas clave -->
    <section class="card">
      <h2 class="title"><span class="dot dot-brand"></span>Fechas clave</h2>

      <div class="toolbar">
        <div class="chips">
          <span class="chip info">Obra: <b id="obraFechaTxt">‚Äî</b></span>
          <span class="chip ok">Ensayos confirmados: <b id="countConfirmados">0</b></span>
          <span class="chip warn">Pendientes: <b id="countPendientes">0</b></span>
        </div>
        <div class="spacer"></div>
      </div>

      <!-- KPIs con progress ring -->
      <div class="kpis">
        <div class="k ring">
          <svg viewBox="0 0 36 36" aria-hidden="true">
            <path d="M18 2 a 16 16 0 1 1 0 32 a 16 16 0 1 1 0 -32" fill="none" stroke="#e5e7eb" stroke-width="4"/>
            <path id="ringProgress" d="M18 2 a 16 16 0 1 1 0 32 a 16 16 0 1 1 0 -32" fill="none" stroke="#a5b4fc" stroke-width="4" stroke-linecap="round" stroke-dasharray="0 100"/>
          </svg>
          <div>
            <div class="v" id="kFaltan">‚Äî</div>
            <div class="l">D√≠as para la obra</div>
          </div>
        </div>
        <div class="k">
          <div class="v" id="kObraDOW">‚Äî</div>
          <div class="l">D√≠a de la semana</div>
        </div>
        <div class="k">
          <div class="v" id="kProximo">‚Äî</div>
          <div class="l">Pr√≥xima fecha</div>
        </div>
      </div>

      <!-- L√≠nea de tiempo -->
      <div class="timeline">
        <div class="line"></div>
        <div class="marks" id="marks"></div>
        <div class="labelrow">
          <span id="lblStart">Hoy</span><span id="lblEnd">Obra</span>
        </div>
      </div>

      <!-- Lista -->
      <div class="list" id="listaFechas"></div>

      <!-- Mini calendario -->
      <div class="mini-cal">
        <div class="cal-head">
          <button class="viewbtn" id="calPrev">‚óÄ</button>
          <div><b id="calTitle">‚Äî</b></div>
          <button class="viewbtn" id="calNext">‚ñ∂</button>
        </div>
        <div class="cal-grid" id="calDows"></div>
        <div class="cal-grid" id="calGrid"></div>
      </div>

      <div class="legend">
        <span class="pill info">programado</span>
        <span class="pill ok">confirmado</span>
        <span class="pill warn">pendiente</span>
      </div>

      <div class="foot">Hoy es <span id="hoyTxt">‚Äî</span>.</div>
    </section>

    <!-- Columna derecha: Programaci√≥n por centros -->
    <section class="card">
      <h2 class="title"><span class="dot dot-alt"></span>Programaci√≥n por Centros</h2>
      <p class="sub">
        Los ensayos se cargan autom√°ticamente desde el archivo oficial en Google Sheets.
      </p>

      <!-- Filtros -->
      <div class="filters">
        <label class="sr-only" for="fCentro">Centro</label>
        <select id="fCentro" onchange="renderTabla();updateSummaryChips();"></select>

        <label class="sr-only" for="fDesde">Desde</label>
        <input type="date" id="fDesde" onchange="renderTabla();updateSummaryChips();">

        <label class="sr-only" for="fHasta">Hasta</label>
        <input type="date" id="fHasta" onchange="renderTabla();updateSummaryChips();">

        <label class="sr-only" for="fEstado">Estado</label>
        <select id="fEstado" onchange="renderTabla();updateSummaryChips();">
          <option value="">Todos los estados</option>
          <option value="programado">Programado</option>
          <option value="confirmado">Confirmado</option>
          <option value="pendiente">Pendiente</option>
        </select>

        <label class="sr-only" for="fArea">√Årea</label>
        <select id="fArea" onchange="renderTabla();updateSummaryChips();">
          <option value="">Todas las √°reas</option>
        </select>

        <!-- Bot√≥n ‚ÄúFiltrar‚Äù eliminado -->
        <button class="viewbtn" id="btnLimpiar">Limpiar</button>
        <div class="spacer"></div>
      </div>

      <!-- Resumen de filtros -->
      <div class="summary" id="summaryChips"></div>

      <!-- Solo tabla -->
      <div class="tablewrap" id="viewTabla" role="region" aria-label="Tabla de programaci√≥n">
        <table>
          <thead>
            <tr>
              <th>Centro</th>
              <th>Fecha</th>
              <th>Hora</th>
              <th>Responsable</th>
              <th>Asistentes</th>
              <th>Estado</th>
              <th>Jornada</th>
              <th>√Årea</th>
            </tr>
          </thead>
          <tbody id="tbodyCentros"></tbody>
        </table>
      </div>
      <!-- El mensaje de ‚ÄúNo hay eventos hoy.‚Äù se pinta con CSS cuando el tbody est√° vac√≠o -->
    </section>
  </main>

  <!-- JS externo -->
  <script src="script.js" defer></script>
</body>
</html>
